<div class="container">
  <div class="row">
    <%= render 'public/homes/BRAND', items: @items %>
    <div class="col-4">
      <%= form_with model: @cart_item,url:cart_items_path(@cart_item), local: true do |f| %>
      <%= attachment_image_tag @item, :image, :fill,300,300 %>
      <% if @item.favorited_by?(current_customer) %>
       <p>
        <%= link_to item_favorite_path(@item), method: :delete do %>
          ♥<%= @item.favorites.count %> いいね
        <% end %>
       </p>
      <% else %>
       <p>
        <%= link_to item_favorites_path(@item), method: :post do %>
          ♡<%= @item.favorites.count %> いいね
        <% end %>
       </p>
      <% end %>
    </div>
    <div class="col-6">
      <table class="table table-borderless">
        <tr>
          <th>商品名</th>
          <td><%= @item.name %>
            　<%= f.hidden_field :item_id, :value => @item.id %>
          </td>
        </tr>
        <tr>
          <th>商品説明</th>
          <td><%= @item.introduction %></td>
        </tr>
        <tr>
          <th>お値段</th>
          <td>￥<%= @item. with_tax_price %>(税込)</td>
        </tr>
        <tr>
          <th></th>
          <td><%= f.select :amount, *[1..10],include_blank: "個数選択" %></td>
        </tr>
        <tr>
          <th></th>
          <td><%= f.submit "カートに入れる",class:"btn btn-success" %></td>
        </tr>
      </table>
      <% end %>
    </div>
  </div>

  <div class="row">
    <div class="col-10">
     <h4 class="font-weight-bolder">レビューを書く</h4>
      <div class="errors">
       <% if @item.errors.any? %>
        <%= @item.errors.count %>件のエラーが発生しました</br>
        <% @item.errors.full_messages.each do |message| %>
         <%= message %></br>
        <% end %>
       <% end %>
      </div>

     <%= form_with model: @review, url: item_reviews_path(@item), local: true do |f| %>
     <label>評価：<span id="rating-form"></label>

      <%= f.text_area :comment, rows:'5', placeholder: "商品のコメント", class: "form-control form-control-sm" %>


      <div class="search">
       <%= f.submit "投稿する" %>

      </div>
     <% end %>
    </div>
  </div>
  <div class="row mx-auto mt-3">
   <div class="col-10">
    <h4 class="font-weight-bolder">カスタマーレビュー</h4>
    <% @item.reviews.each do |review| %>
    <%# rateを表示 %>
    <div class="review-rating">評価：<span id="rate_<%= review.id %>"></span></div>
    <div class="text-left">
     <p>投稿者：<%= review.customer.last_name + review.customer.first_name %></p>
     <p><%= review.comment %></p>
    </div>
    <div class="text-right">
     <p>
      投稿日：<%= review.created_at.strftime('%Y/%m/%d') %>
      <% if review.customer == current_customer %>
       <%= link_to "コメント削除",  item_review_path(item_id: @item.id, id: review.id), method: :delete, class: "btn btn-sm btn-danger"  %>
      <% end %>
     </p>
    </div>
   <% end %>
  </div>
  </div>



  <script>
    $('#rating-form').raty({
        starOn: "<%= asset_path('star-on.png') %>",
        starOff: "<%= asset_path('star-off.png') %>",
        scoreName: 'rate'
    });
    <% @item.reviews.each do |review| %>
    $('#rate_<%= review.id %>').raty({
        starOn: "<%= asset_path('star-on.png') %>",
        starOff: "<%= asset_path('star-off.png') %>",
        readOnly: true,
        score: <%= review.rate %>
    });
    <% end %>
  </script>
  </div>